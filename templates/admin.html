<!doctype html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íŒ€ ê²Œì‹œíŒ</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
  .topnav {
    background-color: #111827;
    color: white;
    padding: 10px 20px;
    display: flex;
    align-items: center;
    position: relative;
  }
  .topnav .menu {
    position: relative;
  }
  .topnav a {
    color: #e5e7eb;
    text-decoration: none;
    font-weight: 500;
    font-size: 14px;
  }
  .submenu {
    display: none;
    position: absolute;
    background-color: #1f2937;
    min-width: 180px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.3);
    z-index: 10;
    border-radius: 8px;
    padding: 8px 0;
  }
  .submenu a {
    display: block;
    padding: 8px 16px;
    color: #e5e7eb;
  }
  .submenu a:hover {
    background-color: #374151;
  }
  .menu:hover .submenu {
    display: block;
  }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', sans-serif;
      background: #f5f6fa;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h2 {
      margin-top: 0;
      font-size: 20px;
      font-weight: 600;
    }
    h3 {
      margin-top: 28px;
      font-size: 16px;
      font-weight: 600;
    }
    .card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.07);
      padding: 16px 20px;
      margin-bottom: 24px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 14px;
    }
    thead th {
      background: #e9ecf5;
      text-align: left;
      padding: 8px 10px;
      font-weight: 600;
      border-bottom: 1px solid #ccd2e0;
    }
    tbody td {
      background: #fff;
      padding: 8px 10px;
      border-bottom: 1px solid #eceff5;
      vertical-align: middle;
    }
    .status-dot-working {
      color: #00a000;
      font-weight: 600;
      font-size: 12px;
      margin-left: 6px;
    }
    .status-dot-off {
      color: #999;
      font-size: 12px;
      margin-left: 6px;
    }
    .admin-action-btn {
      background:#d93025;
      color:#fff;
      border:none;
      border-radius:4px;
      padding:4px 8px;
      font-size:12px;
      cursor:pointer;
    }
    .admin-action-btn.secondary {
      background:#4a4a4a;
    }
    .footer-links {
      text-align:center;
      font-size:14px;
      margin-top:24px;
      line-height:1.6;
    }
    .footer-links a {
      color:#3366cc;
      text-decoration:none;
      margin:0 8px;
    }
    .footer-links a:hover {
      text-decoration:underline;
    }
    .flash-area {
      margin: 12px 0 20px;
      font-size: 14px;
      color: #d93025;
      font-weight: 500;
      list-style: none;
      padding-left: 0;
    }
    .flash-area li {
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <nav class="topnav">
    <div class="menu">
      <a href="{{ url_for('dashboard') }}">ğŸ  ë‚´ ë©”ë‰´</a>
      <div class="submenu">
        <a href="{{ url_for('profiles') }}">ğŸ‘¥ íŒ€ ìƒíƒœíŒ</a>
        <a href="{{ url_for('weekly') }}">ğŸ“… ì£¼ê°„ í˜„í™©íŒ</a>
        <a href="{{ url_for('monthly') }}">ğŸ“Š ì›”ê°„ í˜„í™©íŒ</a>
        <a href="{{ url_for('board') }}">ğŸ’¬ íŒ€ ê²Œì‹œíŒ</a>
        <a href="{{ url_for('change_password') }}">ğŸ” ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a>
        <a href="{{ url_for('logout') }}">ğŸšª ë¡œê·¸ì•„ì›ƒ</a>
      </div>
    </div>
  </nav>

  <div class="card">
    <h2>{{ month }} ì›” ê·¼ë¬´ í˜„í™©</h2>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="flash-area">
        {% for m in messages %}
          <li>{{ m }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <h3>ì‚¬ëŒë³„ í•©ê³„</h3>
    <table>
      <thead>
        <tr>
          <th style="width:200px;">ì´ë¦„ / ìƒíƒœ</th>
          <th style="width:140px;">ì´ë²ˆë‹¬ í•©ê³„(ë¶„)</th>
          <th style="width:160px;">ì´ë²ˆë‹¬ í•©ê³„(ì‹œ:ë¶„)</th>
          <th style="width:220px;">ê´€ë¦¬</th>
        </tr>
      </thead>
      <tbody>
        {% for row in per_user %}
          {% set h = (row.total_min // 60) %}
          {% set m = (row.total_min % 60) %}
          <tr>
            <td>
              {{ row.username }}
              {% if row.uid in active_user_ids %}
                <span class="status-dot-working">â— ê·¼ë¬´ì¤‘</span>
              {% else %}
                <span class="status-dot-off">â— í‡´ê·¼</span>
              {% endif %}
            </td>

            <td>{{ row.total_min }}</td>
            <td>{{ "%d:%02d" % (h, m) }}</td>

            <td>
              {% if session.get('is_admin') %}

                {# ê°•ì œ í‡´ê·¼ ë²„íŠ¼: /admin_force_checkout/<user_id> ì— POST  #}
                {% if row.uid in active_user_ids %}
                  <form method="post" action="{{ url_for('admin_force_checkout', user_id=row.uid) }}" style="display:inline;">
                    <button type="submit" class="admin-action-btn" onclick="return confirm('{{ row.username }} ì‚¬ìš©ìë¥¼ ì§€ê¸ˆ í‡´ê·¼ ì²˜ë¦¬í• ê¹Œìš”?')">
                      ê°•ì œ í‡´ê·¼
                    </button>
                  </form>
                {% else %}
                  <span style="color:#666; font-size:12px; margin-right:8px;">(í‡´ê·¼ ìƒíƒœ)</span>
                {% endif %}

                {# ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” ë²„íŠ¼: /admin_reset/<username> ì— POST #}
                <form method="post" action="{{ url_for('admin_reset', username=row.username) }}" style="display:inline; margin-left:4px;">
                  <button type="submit" class="admin-action-btn secondary" onclick="return confirm('{{ row.username }} ë¹„ë°€ë²ˆí˜¸ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í• ê¹Œìš”?')">
                    ë¹„ë²ˆì´ˆê¸°í™”
                  </button>
                </form>

                {# ìœ ì € ì‚­ì œ ë²„íŠ¼: /admin_delete_user/<username> ì— POST #}
                {% if row.username != 'dongguk' %}
                <form method="post" action="{{ url_for('admin_delete_user', username=row.username) }}" style="display:inline; margin-left:4px;">
                  <button type="submit" class="admin-action-btn" onclick="return confirm('{{ row.username }} ê³„ì •ì„ ì™„ì „íˆ ì‚­ì œí• ê¹Œìš”? ì´ ì‘ì—…ì€ ë³µêµ¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')">
                    ì‚­ì œ
                  </button>
                </form>
                {% endif %}

              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card">
    <h3>ìµœê·¼ ê¸°ë¡</h3>
    <table>
      <thead>
        <tr>
          <th style="width:120px;">ë‚ ì§œ</th>
          <th style="width:140px;">ì´ë¦„</th>
          <th style="width:100px;">ì¶œê·¼</th>
          <th style="width:100px;">í‡´ê·¼</th>
          <th style="width:120px;">ê·¼ë¬´(ë¶„)</th>
        </tr>
      </thead>
      <tbody>
        {% for rec in recent %}
        <tr>
          <td>{{ rec.date }}</td>
          <td>{{ rec.username }}</td>
          <td>{{ rec.time_in }}</td>
          <td>{{ rec.time_out if rec.time_out else '-' }}</td>
          <td>{{ rec.work_minutes if rec.work_minutes else '-' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="footer-links">
    <a href="{{ url_for('dashboard') }}">ğŸ  ë‚´ í™”ë©´ìœ¼ë¡œ</a>
    <a href="{{ url_for('profiles') }}">ğŸ‘¥ íŒ€ ìƒíƒœíŒ</a>
    <a href="{{ url_for('weekly') }}">ğŸƒ ì£¼ê°„ í˜„í™©íŒ</a>
    <a href="{{ url_for('admin_add_user') }}">â• ìƒˆ ìœ ì € ì¶”ê°€</a>
  </div>

</body>
</html>